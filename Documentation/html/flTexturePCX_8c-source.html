<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>funcLib: flTexturePCX.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.1 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="annotated.html"><span>Classes</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
  </ul></div>
<h1>flTexturePCX.c</h1><a href="flTexturePCX_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#include "<a class="code" href="flGlobal_8h.html">flGlobal.h</a>"</span>
<a name="l00002"></a>00002 <span class="preprocessor">#if FL_TEXTURE_PCX != 0</span>
<a name="l00003"></a>00003 <span class="preprocessor"></span><span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00004"></a>00004 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00005"></a>00005 <span class="preprocessor">#include &lt;pspgu.h&gt;</span>
<a name="l00006"></a>00006 
<a name="l00007"></a>00007 <span class="preprocessor">#if FL_INCLUDE_ALL_C == 0</span>
<a name="l00008"></a>00008 <span class="preprocessor"></span><span class="preprocessor">#include "<a class="code" href="flTexturePCX_8h.html">flTexturePCX.h</a>"</span>
<a name="l00009"></a>00009 <span class="preprocessor">#include "<a class="code" href="flMemory_8h.html">flMemory.h</a>"</span>
<a name="l00010"></a>00010 <span class="preprocessor">#include "<a class="code" href="flFile_8h.html">flFile.h</a>"</span>
<a name="l00011"></a>00011 
<a name="l00012"></a>00012 <span class="preprocessor">#if FL_DEBUG != 0</span>
<a name="l00013"></a>00013 <span class="preprocessor"></span><span class="preprocessor">#include "<a class="code" href="flDebug_8h.html">flDebug.h</a>"</span>
<a name="l00014"></a>00014 <span class="preprocessor">#endif</span>
<a name="l00015"></a>00015 <span class="preprocessor"></span>
<a name="l00016"></a>00016 <span class="preprocessor">#endif</span>
<a name="l00017"></a>00017 <span class="preprocessor"></span>
<a name="l00018"></a><a class="code" href="structpcxFileHeader.html">00018</a> <span class="keyword">typedef</span> <span class="keyword">struct </span>{
<a name="l00019"></a><a class="code" href="structpcxFileHeader.html#f65b6d4d114fce1707a8ddbf7ba1c59b">00019</a>      <span class="keywordtype">char</span>  manufacturer;
<a name="l00020"></a><a class="code" href="structpcxFileHeader.html#85a9ef6888cfca791c8ea5d81abcf323">00020</a>      <span class="keywordtype">char</span>  version;
<a name="l00021"></a><a class="code" href="structpcxFileHeader.html#5fd6d9a2cc0da5fdb7f7c455fc47dff2">00021</a>      <span class="keywordtype">char</span>  encoding;
<a name="l00022"></a><a class="code" href="structpcxFileHeader.html#2ce9823a32c4402abd555efda2264fad">00022</a>      <span class="keywordtype">char</span>  bpp;
<a name="l00023"></a><a class="code" href="structpcxFileHeader.html#c3538657366a57a8840f6ce8fa775517">00023</a>      <span class="keywordtype">short</span> xMin;
<a name="l00024"></a><a class="code" href="structpcxFileHeader.html#69fa3ab1416c69fa7e0eb288ccc3849a">00024</a>      <span class="keywordtype">short</span> yMin;
<a name="l00025"></a><a class="code" href="structpcxFileHeader.html#fcda63520f50fabc79f1fdd5d8ba0684">00025</a>      <span class="keywordtype">short</span> xMax;
<a name="l00026"></a><a class="code" href="structpcxFileHeader.html#d647e0f9eda4717cb847948b3d6d40fe">00026</a>      <span class="keywordtype">short</span> yMax;
<a name="l00027"></a><a class="code" href="structpcxFileHeader.html#03b1b0f063315c052b6d5e495aa96d0c">00027</a>      <span class="keywordtype">short</span> horizontalDPI;
<a name="l00028"></a><a class="code" href="structpcxFileHeader.html#9b1a862bfa9008d6b413240da0ce9dc3">00028</a>      <span class="keywordtype">short</span> verticalDPI;
<a name="l00029"></a><a class="code" href="structpcxFileHeader.html#5cb08f052b40f61c6f79fcca379889f1">00029</a>      <span class="keywordtype">char</span>  palette[48];
<a name="l00030"></a><a class="code" href="structpcxFileHeader.html#28483a4bc2867a9dc2e49a748b4920a4">00030</a>      <span class="keywordtype">char</span>  reserved;
<a name="l00031"></a><a class="code" href="structpcxFileHeader.html#e11610c28a3073b59532ac847f7472ca">00031</a>      <span class="keywordtype">char</span>  colorPlanes;
<a name="l00032"></a><a class="code" href="structpcxFileHeader.html#504c786390a59a3983c88954e40915e4">00032</a>      <span class="keywordtype">short</span> bytesPerLine;
<a name="l00033"></a><a class="code" href="structpcxFileHeader.html#bee099b66a00a7726732fab23168def5">00033</a>      <span class="keywordtype">short</span> paletteType;
<a name="l00034"></a><a class="code" href="structpcxFileHeader.html#62327d7ce840780333610fc657526175">00034</a>      <span class="keywordtype">short</span> hScrSize;
<a name="l00035"></a><a class="code" href="structpcxFileHeader.html#07b460699d42227fb2c4f9acde62c3fa">00035</a>      <span class="keywordtype">short</span> vScrSize;
<a name="l00036"></a><a class="code" href="structpcxFileHeader.html#b8715380600b62b84e290a192699ae8f">00036</a>      <span class="keywordtype">char</span>  filler[54];
<a name="l00037"></a>00037 } <a class="code" href="structpcxFileHeader.html">pcxFileHeader</a>;
<a name="l00038"></a>00038 
<a name="l00039"></a><a class="code" href="flTexturePCX_8h.html#9d7641e47c72b61961e1147e415a9153">00039</a> <a class="code" href="structTexture.html">Texture</a>* <a class="code" href="flTexturePCX_8c.html#9d7641e47c72b61961e1147e415a9153">texLoadPCX</a>(<span class="keywordtype">char</span>* inPath) {
<a name="l00040"></a>00040 <span class="preprocessor">     #if FL_FILE != 0</span>
<a name="l00041"></a>00041 <span class="preprocessor"></span>     <a class="code" href="structFile.html">File</a>* tempFile = <a class="code" href="flFile_8c.html#c93941480776a7835fc0b7eec7ebea85">fileOpen</a>(inPath, <a class="code" href="flFile_8h.html#01a82af4b478b1d490bf495e26c319d8">FILE_MODE_READ</a> | <a class="code" href="flFile_8h.html#0f396696b14f2798b74cab1408c7f554">FILE_MODE_BINARY</a>);
<a name="l00042"></a>00042 <span class="preprocessor">     #else</span>
<a name="l00043"></a>00043 <span class="preprocessor"></span>     FILE* tempFile = fopen(inPath, <span class="stringliteral">"rb"</span>);
<a name="l00044"></a>00044 <span class="preprocessor">     #endif</span>
<a name="l00045"></a>00045 <span class="preprocessor"></span>     <span class="keywordflow">if</span>(!tempFile) {
<a name="l00046"></a>00046 <span class="preprocessor">          #if FL_DEBUG_ERROR != 0</span>
<a name="l00047"></a>00047 <span class="preprocessor"></span>          <a class="code" href="flDebug_8h.html#2cd68b8e989a5902ba62dabe20596f07">debugError</a>(<span class="stringliteral">"PCX load error (%s).\nFile cannot be opened"</span>, inPath);
<a name="l00048"></a>00048 <span class="preprocessor">          #endif</span>
<a name="l00049"></a>00049 <span class="preprocessor"></span>          <span class="keywordflow">return</span> <a class="code" href="flTypes_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00050"></a>00050      }
<a name="l00051"></a>00051      <a class="code" href="structpcxFileHeader.html">pcxFileHeader</a> tempHeader;
<a name="l00052"></a>00052      
<a name="l00053"></a>00053      <a class="code" href="flFile_8c.html#bd15952bb98932926572c806c3b3cf20">fileRead</a>(&amp;tempHeader.<a class="code" href="structpcxFileHeader.html#f65b6d4d114fce1707a8ddbf7ba1c59b">manufacturer</a>, 1, tempFile);
<a name="l00054"></a>00054      <a class="code" href="flFile_8c.html#bd15952bb98932926572c806c3b3cf20">fileRead</a>(&amp;tempHeader.<a class="code" href="structpcxFileHeader.html#85a9ef6888cfca791c8ea5d81abcf323">version</a>, 1, tempFile);
<a name="l00055"></a>00055      <span class="keywordflow">if</span>((tempHeader.<a class="code" href="structpcxFileHeader.html#85a9ef6888cfca791c8ea5d81abcf323">version</a> != 0) &amp;&amp; (tempHeader.<a class="code" href="structpcxFileHeader.html#85a9ef6888cfca791c8ea5d81abcf323">version</a> != 2) &amp;&amp; (tempHeader.<a class="code" href="structpcxFileHeader.html#85a9ef6888cfca791c8ea5d81abcf323">version</a> != 5)) {
<a name="l00056"></a>00056 <span class="preprocessor">          #if FL_DEBUG_ERROR != 0</span>
<a name="l00057"></a>00057 <span class="preprocessor"></span>          <a class="code" href="flDebug_8h.html#2cd68b8e989a5902ba62dabe20596f07">debugError</a>(<span class="stringliteral">"PCX file error (%s).\nVersion not supported (%i).\nSupported versions are 0, 2 &amp; 5."</span>, inPath, tempHeader.<a class="code" href="structpcxFileHeader.html#85a9ef6888cfca791c8ea5d81abcf323">version</a>);
<a name="l00058"></a>00058 <span class="preprocessor">          #endif</span>
<a name="l00059"></a>00059 <span class="preprocessor"></span>          <a class="code" href="flFile_8c.html#bdd17f626a43391a546883c7a0544dc3">fileClose</a>(tempFile);
<a name="l00060"></a>00060           <span class="keywordflow">return</span> <a class="code" href="flTypes_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00061"></a>00061      }
<a name="l00062"></a>00062      <a class="code" href="flFile_8c.html#bd15952bb98932926572c806c3b3cf20">fileRead</a>(&amp;tempHeader.<a class="code" href="structpcxFileHeader.html#5fd6d9a2cc0da5fdb7f7c455fc47dff2">encoding</a>, 1, tempFile);
<a name="l00063"></a>00063      <a class="code" href="flFile_8c.html#bd15952bb98932926572c806c3b3cf20">fileRead</a>(&amp;tempHeader.<a class="code" href="structpcxFileHeader.html#2ce9823a32c4402abd555efda2264fad">bpp</a>, 1, tempFile);
<a name="l00064"></a>00064      <span class="keywordflow">if</span>((tempHeader.<a class="code" href="structpcxFileHeader.html#2ce9823a32c4402abd555efda2264fad">bpp</a> != 1) &amp;&amp; (tempHeader.<a class="code" href="structpcxFileHeader.html#2ce9823a32c4402abd555efda2264fad">bpp</a> != 4) &amp;&amp; (tempHeader.<a class="code" href="structpcxFileHeader.html#2ce9823a32c4402abd555efda2264fad">bpp</a> != 8) &amp;&amp; (tempHeader.<a class="code" href="structpcxFileHeader.html#2ce9823a32c4402abd555efda2264fad">bpp</a> != 24)) {
<a name="l00065"></a>00065 <span class="preprocessor">          #if FL_DEBUG_ERROR != 0</span>
<a name="l00066"></a>00066 <span class="preprocessor"></span>          <a class="code" href="flDebug_8h.html#2cd68b8e989a5902ba62dabe20596f07">debugError</a>(<span class="stringliteral">"PCX file error (%s).\nBPP not supported (%i).\nSupported BPPs are 1, 4, 8 &amp; 24."</span>, inPath, tempHeader.<a class="code" href="structpcxFileHeader.html#2ce9823a32c4402abd555efda2264fad">bpp</a>);
<a name="l00067"></a>00067 <span class="preprocessor">          #endif</span>
<a name="l00068"></a>00068 <span class="preprocessor"></span>          <a class="code" href="flFile_8c.html#bdd17f626a43391a546883c7a0544dc3">fileClose</a>(tempFile);
<a name="l00069"></a>00069           <span class="keywordflow">return</span> <a class="code" href="flTypes_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00070"></a>00070      }
<a name="l00071"></a>00071      
<a name="l00072"></a>00072      <a class="code" href="flFile_8c.html#bd15952bb98932926572c806c3b3cf20">fileRead</a>(&amp;tempHeader.<a class="code" href="structpcxFileHeader.html#c3538657366a57a8840f6ce8fa775517">xMin</a>, 2, tempFile);
<a name="l00073"></a>00073      <a class="code" href="flFile_8c.html#bd15952bb98932926572c806c3b3cf20">fileRead</a>(&amp;tempHeader.<a class="code" href="structpcxFileHeader.html#69fa3ab1416c69fa7e0eb288ccc3849a">yMin</a>, 2, tempFile);
<a name="l00074"></a>00074      <a class="code" href="flFile_8c.html#bd15952bb98932926572c806c3b3cf20">fileRead</a>(&amp;tempHeader.<a class="code" href="structpcxFileHeader.html#fcda63520f50fabc79f1fdd5d8ba0684">xMax</a>, 2, tempFile);
<a name="l00075"></a>00075      <a class="code" href="flFile_8c.html#bd15952bb98932926572c806c3b3cf20">fileRead</a>(&amp;tempHeader.<a class="code" href="structpcxFileHeader.html#d647e0f9eda4717cb847948b3d6d40fe">yMax</a>, 2, tempFile);
<a name="l00076"></a>00076      <a class="code" href="flFile_8c.html#bd15952bb98932926572c806c3b3cf20">fileRead</a>(&amp;tempHeader.<a class="code" href="structpcxFileHeader.html#03b1b0f063315c052b6d5e495aa96d0c">horizontalDPI</a>, 2, tempFile);
<a name="l00077"></a>00077      <a class="code" href="flFile_8c.html#bd15952bb98932926572c806c3b3cf20">fileRead</a>(&amp;tempHeader.<a class="code" href="structpcxFileHeader.html#9b1a862bfa9008d6b413240da0ce9dc3">verticalDPI</a>, 2, tempFile);
<a name="l00078"></a>00078      <a class="code" href="flFile_8c.html#bd15952bb98932926572c806c3b3cf20">fileRead</a>(&amp;tempHeader.<a class="code" href="structpcxFileHeader.html#5cb08f052b40f61c6f79fcca379889f1">palette</a>[0], 48, tempFile);
<a name="l00079"></a>00079      <a class="code" href="flFile_8c.html#bd15952bb98932926572c806c3b3cf20">fileRead</a>(&amp;tempHeader.<a class="code" href="structpcxFileHeader.html#28483a4bc2867a9dc2e49a748b4920a4">reserved</a>, 1, tempFile);
<a name="l00080"></a>00080      <a class="code" href="flFile_8c.html#bd15952bb98932926572c806c3b3cf20">fileRead</a>(&amp;tempHeader.<a class="code" href="structpcxFileHeader.html#e11610c28a3073b59532ac847f7472ca">colorPlanes</a>, 1, tempFile);
<a name="l00081"></a>00081      <span class="comment">//if((tempHeader.colorPlanes != 3) &amp;&amp; (tempHeader.colorPlanes != 4))</span>
<a name="l00082"></a>00082      <span class="comment">//     tempHeader.colorPlanes = 1;</span>
<a name="l00083"></a>00083      <a class="code" href="flFile_8c.html#bd15952bb98932926572c806c3b3cf20">fileRead</a>(&amp;tempHeader.<a class="code" href="structpcxFileHeader.html#504c786390a59a3983c88954e40915e4">bytesPerLine</a>, 2, tempFile);
<a name="l00084"></a>00084      <a class="code" href="flFile_8c.html#bd15952bb98932926572c806c3b3cf20">fileRead</a>(&amp;tempHeader.<a class="code" href="structpcxFileHeader.html#bee099b66a00a7726732fab23168def5">paletteType</a>, 2, tempFile);
<a name="l00085"></a>00085      <a class="code" href="flFile_8c.html#bd15952bb98932926572c806c3b3cf20">fileRead</a>(&amp;tempHeader.<a class="code" href="structpcxFileHeader.html#62327d7ce840780333610fc657526175">hScrSize</a>, 2, tempFile);
<a name="l00086"></a>00086      <a class="code" href="flFile_8c.html#bd15952bb98932926572c806c3b3cf20">fileRead</a>(&amp;tempHeader.<a class="code" href="structpcxFileHeader.html#07b460699d42227fb2c4f9acde62c3fa">vScrSize</a>, 2, tempFile);
<a name="l00087"></a>00087      <a class="code" href="flFile_8c.html#bd15952bb98932926572c806c3b3cf20">fileRead</a>(&amp;tempHeader.<a class="code" href="structpcxFileHeader.html#b8715380600b62b84e290a192699ae8f">filler</a>[0], 54, tempFile);
<a name="l00088"></a>00088      
<a name="l00089"></a>00089      <span class="keywordtype">int</span> tempWidth = (tempHeader.<a class="code" href="structpcxFileHeader.html#fcda63520f50fabc79f1fdd5d8ba0684">xMax</a> - tempHeader.<a class="code" href="structpcxFileHeader.html#c3538657366a57a8840f6ce8fa775517">xMin</a>);
<a name="l00090"></a>00090      <span class="keywordtype">int</span> tempHeight = (tempHeader.<a class="code" href="structpcxFileHeader.html#d647e0f9eda4717cb847948b3d6d40fe">yMax</a> - tempHeader.<a class="code" href="structpcxFileHeader.html#69fa3ab1416c69fa7e0eb288ccc3849a">yMin</a>);
<a name="l00091"></a>00091      <span class="keywordflow">if</span>(tempWidth &lt;= 0)
<a name="l00092"></a>00092           tempWidth = 0 - tempWidth;
<a name="l00093"></a>00093      <span class="keywordflow">if</span>(tempHeight &lt;= 0)
<a name="l00094"></a>00094           tempHeight = 0 - tempHeight;          
<a name="l00095"></a>00095      tempHeight++;
<a name="l00096"></a>00096      tempWidth++;
<a name="l00097"></a>00097           
<a name="l00098"></a>00098      u8* tempData = (u8*)<a class="code" href="flMemory_8h.html#39edd59a7b482bd6b887b0786b74ce42">memQalloc</a>(tempHeader.<a class="code" href="structpcxFileHeader.html#504c786390a59a3983c88954e40915e4">bytesPerLine</a> * tempHeader.<a class="code" href="structpcxFileHeader.html#e11610c28a3073b59532ac847f7472ca">colorPlanes</a> * tempHeight);
<a name="l00099"></a>00099      <span class="keywordflow">if</span>(!tempData) {
<a name="l00100"></a>00100 <span class="preprocessor">          #if FL_DEBUG_ERROR != 0</span>
<a name="l00101"></a>00101 <span class="preprocessor"></span>          <a class="code" href="flDebug_8h.html#2cd68b8e989a5902ba62dabe20596f07">debugError</a>(<span class="stringliteral">"PCX load error (%s).\nOut of memory."</span>, inPath);
<a name="l00102"></a>00102 <span class="preprocessor">          #endif</span>
<a name="l00103"></a>00103 <span class="preprocessor"></span>          <a class="code" href="flFile_8c.html#bdd17f626a43391a546883c7a0544dc3">fileClose</a>(tempFile);
<a name="l00104"></a>00104           <span class="keywordflow">return</span> <a class="code" href="flTypes_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00105"></a>00105      }
<a name="l00106"></a>00106      u8    tempChar;
<a name="l00107"></a>00107      u32   tempX = 0;
<a name="l00108"></a>00108      u32   tempLine;
<a name="l00109"></a>00109      u32   tempPlane;
<a name="l00110"></a>00110      u8    tempCount;
<a name="l00111"></a>00111      u32   i;
<a name="l00112"></a>00112      <span class="keywordflow">if</span>(tempHeader.<a class="code" href="structpcxFileHeader.html#5fd6d9a2cc0da5fdb7f7c455fc47dff2">encoding</a> == 1) {
<a name="l00113"></a>00113           <span class="keywordflow">for</span>(tempLine = 0; tempLine &lt; tempHeight; tempLine++) {
<a name="l00114"></a>00114                <span class="keywordflow">for</span>(tempPlane = 0; tempPlane &lt; tempHeader.<a class="code" href="structpcxFileHeader.html#e11610c28a3073b59532ac847f7472ca">colorPlanes</a>; tempPlane++) {
<a name="l00115"></a>00115                     tempX = 0;
<a name="l00116"></a>00116                     <span class="keywordflow">while</span>(tempX &lt; tempHeader.<a class="code" href="structpcxFileHeader.html#504c786390a59a3983c88954e40915e4">bytesPerLine</a>) {
<a name="l00117"></a>00117                          <a class="code" href="flFile_8c.html#bd15952bb98932926572c806c3b3cf20">fileRead</a>(&amp;tempChar, 1, tempFile);
<a name="l00118"></a>00118                          <span class="keywordflow">if</span>((tempChar &amp; 0xC0) == 0xC0) {
<a name="l00119"></a>00119                               tempCount = (tempChar &amp; 0x3F);
<a name="l00120"></a>00120                               <a class="code" href="flFile_8c.html#bd15952bb98932926572c806c3b3cf20">fileRead</a>(&amp;tempChar, 1, tempFile);
<a name="l00121"></a>00121                          } <span class="keywordflow">else</span>
<a name="l00122"></a>00122                               tempCount = 1;
<a name="l00123"></a>00123                          <span class="keywordflow">for</span>(i = 0; i &lt; tempCount; i++)
<a name="l00124"></a>00124                               tempData[(((tempLine * tempHeader.<a class="code" href="structpcxFileHeader.html#e11610c28a3073b59532ac847f7472ca">colorPlanes</a>) + tempPlane) * tempHeader.<a class="code" href="structpcxFileHeader.html#504c786390a59a3983c88954e40915e4">bytesPerLine</a>) + tempX + i] = tempChar;
<a name="l00125"></a>00125                          tempX += tempCount;
<a name="l00126"></a>00126                     }
<a name="l00127"></a>00127                }
<a name="l00128"></a>00128           }
<a name="l00129"></a>00129      } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(tempHeader.encoding == 0) {
<a name="l00130"></a>00130           <span class="keywordflow">for</span>(tempLine = 0; tempLine &lt; tempHeight; tempLine++) {
<a name="l00131"></a>00131                <span class="keywordflow">for</span>(tempPlane = 0; tempPlane &lt; tempHeader.colorPlanes; tempPlane++)
<a name="l00132"></a>00132                     <a class="code" href="flFile_8c.html#bd15952bb98932926572c806c3b3cf20">fileRead</a>(&amp;tempData[((tempLine * tempHeader.colorPlanes) + tempPlane) * tempHeader.bytesPerLine], tempHeader.bytesPerLine, tempFile);
<a name="l00133"></a>00133           }
<a name="l00134"></a>00134      } <span class="keywordflow">else</span> {
<a name="l00135"></a>00135 <span class="preprocessor">          #if FL_DEBUG_ERROR != 0</span>
<a name="l00136"></a>00136 <span class="preprocessor"></span>          <a class="code" href="flDebug_8h.html#2cd68b8e989a5902ba62dabe20596f07">debugError</a>(<span class="stringliteral">"PCX load error (%s).\nEncoding type %i not supported."</span>, inPath, tempHeader.encoding);
<a name="l00137"></a>00137 <span class="preprocessor">          #endif</span>
<a name="l00138"></a>00138 <span class="preprocessor"></span>          <a class="code" href="flFile_8c.html#bdd17f626a43391a546883c7a0544dc3">fileClose</a>(tempFile);
<a name="l00139"></a>00139           <span class="keywordflow">return</span> <a class="code" href="flTypes_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;            
<a name="l00140"></a>00140      }
<a name="l00141"></a>00141      
<a name="l00142"></a>00142      <span class="keywordtype">char</span>* tempPalette = tempHeader.palette;
<a name="l00143"></a>00143      <span class="keywordtype">char</span> tempBigPalette[768];
<a name="l00144"></a>00144      <span class="keywordflow">if</span>((tempHeader.bpp == 8) &amp;&amp; (tempHeader.colorPlanes == 1)) {
<a name="l00145"></a>00145           <a class="code" href="flFile_8c.html#e5232070b4bd85cfcbeee00f4e8e32a4">fileSeek</a>(tempFile, -769, <a class="code" href="flFile_8h.html#3c580687c3aced8196380525e9532973">FILE_SEEK_END</a>);
<a name="l00146"></a>00146           <a class="code" href="flFile_8c.html#bd15952bb98932926572c806c3b3cf20">fileRead</a>(&amp;tempChar, 1, tempFile);
<a name="l00147"></a>00147           <span class="keywordflow">if</span>(tempChar == 12) {
<a name="l00148"></a>00148                <a class="code" href="flFile_8c.html#bd15952bb98932926572c806c3b3cf20">fileRead</a>(&amp;tempBigPalette[0], 768, tempFile);
<a name="l00149"></a>00149                tempPalette = tempBigPalette;
<a name="l00150"></a>00150           }
<a name="l00151"></a>00151      }
<a name="l00152"></a>00152      <a class="code" href="flFile_8c.html#bdd17f626a43391a546883c7a0544dc3">fileClose</a>(tempFile);
<a name="l00153"></a>00153      
<a name="l00154"></a>00154 
<a name="l00155"></a>00155      u8 tempPixelFormat = GU_PSM_8888;
<a name="l00156"></a>00156      u8 tempRealBPP = (tempHeader.colorPlanes * tempHeader.bpp);
<a name="l00157"></a>00157      <span class="keywordflow">if</span>(tempRealBPP &lt;= 4) {
<a name="l00158"></a>00158           tempPixelFormat = GU_PSM_T4;
<a name="l00159"></a>00159      } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(tempRealBPP == 8) {
<a name="l00160"></a>00160           tempPixelFormat = GU_PSM_T8;
<a name="l00161"></a>00161      }
<a name="l00162"></a>00162      <a class="code" href="structTexture.html">Texture</a>* tempOut = <a class="code" href="flTexture_8c.html#4cdb1a72f4cf0008c2cbce4ce95c99e2">texCreate</a>(tempWidth, tempHeight, tempPixelFormat);
<a name="l00163"></a>00163      <span class="keywordflow">if</span>(!tempOut) {
<a name="l00164"></a>00164 <span class="preprocessor">          #if FL_DEBUG_ERROR != 0</span>
<a name="l00165"></a>00165 <span class="preprocessor"></span>          <a class="code" href="flDebug_8h.html#2cd68b8e989a5902ba62dabe20596f07">debugError</a>(<span class="stringliteral">"PCX load error (%s).\nCouldn't create texture struct."</span>, inPath);
<a name="l00166"></a>00166 <span class="preprocessor">          #endif</span>
<a name="l00167"></a>00167 <span class="preprocessor"></span>          <span class="keywordflow">return</span> <a class="code" href="flTypes_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00168"></a>00168      }
<a name="l00169"></a>00169 <span class="preprocessor">     #if FL_TEXTURE_PRESERVENONALPHA != 0</span>
<a name="l00170"></a>00170 <span class="preprocessor"></span>     tempOut-&gt;<a class="code" href="structTexture.html#1e77e466ea5a49a2b60ee743b00d2605">texAlpha</a> = <span class="keyword">false</span>;
<a name="l00171"></a>00171 <span class="preprocessor">     #endif</span>
<a name="l00172"></a>00172 <span class="preprocessor"></span>
<a name="l00173"></a>00173      
<a name="l00174"></a>00174      <span class="keywordflow">if</span>(<a class="code" href="flTexture_8c.html#b4c79c10195fdf369c6c9152a350eb78">texPalettized</a>(tempOut)) {
<a name="l00175"></a>00175           tempOut-&gt;<a class="code" href="structTexture.html#01d7cb5c9b302dea1b79112f1cf1cb37">texPalette</a> = <a class="code" href="flTexture_8c.html#e3ed244173473fbbe4f84cc8e773ca88">palCreate</a>((tempPixelFormat == GU_PSM_T4 ? 16 : 256) , GU_PSM_8888, <span class="keyword">false</span>);
<a name="l00176"></a>00176           <span class="keywordflow">for</span>(i = 0; i &lt; (1 &lt;&lt; tempHeader.bpp); i++) {
<a name="l00177"></a>00177                tempOut-&gt;<a class="code" href="structTexture.html#01d7cb5c9b302dea1b79112f1cf1cb37">texPalette</a>-&gt;<a class="code" href="structPalette.html#fe95a9fca04cb4066dc4651cd604c7b0">palData</a>[i &lt;&lt; 2] = tempPalette[i * 3];
<a name="l00178"></a>00178                tempOut-&gt;<a class="code" href="structTexture.html#01d7cb5c9b302dea1b79112f1cf1cb37">texPalette</a>-&gt;<a class="code" href="structPalette.html#fe95a9fca04cb4066dc4651cd604c7b0">palData</a>[(i &lt;&lt; 2) + 1] = tempPalette[(i * 3) + 1];
<a name="l00179"></a>00179                tempOut-&gt;<a class="code" href="structTexture.html#01d7cb5c9b302dea1b79112f1cf1cb37">texPalette</a>-&gt;<a class="code" href="structPalette.html#fe95a9fca04cb4066dc4651cd604c7b0">palData</a>[(i &lt;&lt; 2) + 2] = tempPalette[(i * 3) + 2];
<a name="l00180"></a>00180                tempOut-&gt;<a class="code" href="structTexture.html#01d7cb5c9b302dea1b79112f1cf1cb37">texPalette</a>-&gt;<a class="code" href="structPalette.html#fe95a9fca04cb4066dc4651cd604c7b0">palData</a>[(i &lt;&lt; 2) + 3] = 0xFF;
<a name="l00181"></a>00181           }
<a name="l00182"></a>00182      }
<a name="l00183"></a>00183      
<a name="l00184"></a>00184      <span class="keywordflow">if</span>(tempHeader.colorPlanes &lt;= 1) {
<a name="l00185"></a>00185           <span class="keywordflow">if</span>(tempHeader.bpp == 1) {
<a name="l00186"></a>00186                <span class="keywordflow">for</span>(tempLine = 0; tempLine &lt; tempHeight; tempLine++) {
<a name="l00187"></a>00187                     <span class="keywordflow">for</span>(tempX = 0; tempX &lt; ((tempWidth + 7) &gt;&gt; 3); tempX++) {
<a name="l00188"></a>00188                          tempOut-&gt;<a class="code" href="structTexture.html#4384d0e3734c3a45f6ebc36f6738962d">texData</a>[(tempLine * tempOut-&gt;<a class="code" href="structTexture.html#e23e28838c5e73a89d7216c9d84a9bdd">texDataWidth</a>) + (tempX &lt;&lt; 2)] = ((tempData[(tempLine * tempHeader.bytesPerLine) + tempX] &amp; 0x80) &gt;&gt; 3) + ((tempData[(tempLine * tempHeader.bytesPerLine) + tempX] &amp; 0x40) &gt;&gt; 6);
<a name="l00189"></a>00189                          tempOut-&gt;<a class="code" href="structTexture.html#4384d0e3734c3a45f6ebc36f6738962d">texData</a>[(tempLine * tempOut-&gt;<a class="code" href="structTexture.html#e23e28838c5e73a89d7216c9d84a9bdd">texDataWidth</a>) + (tempX &lt;&lt; 2) + 1] = ((tempData[(tempLine * tempHeader.bytesPerLine) + tempX] &amp; 0x20) &gt;&gt; 1) + ((tempData[(tempLine * tempHeader.bytesPerLine) + tempX] &amp; 0x10) &gt;&gt; 4);
<a name="l00190"></a>00190                          tempOut-&gt;<a class="code" href="structTexture.html#4384d0e3734c3a45f6ebc36f6738962d">texData</a>[(tempLine * tempOut-&gt;<a class="code" href="structTexture.html#e23e28838c5e73a89d7216c9d84a9bdd">texDataWidth</a>) + (tempX &lt;&lt; 2) + 2] = ((tempData[(tempLine * tempHeader.bytesPerLine) + tempX] &amp; 0x08) &lt;&lt; 1) + ((tempData[(tempLine * tempHeader.bytesPerLine) + tempX] &amp; 0x04) &gt;&gt; 2);
<a name="l00191"></a>00191                          tempOut-&gt;<a class="code" href="structTexture.html#4384d0e3734c3a45f6ebc36f6738962d">texData</a>[(tempLine * tempOut-&gt;<a class="code" href="structTexture.html#e23e28838c5e73a89d7216c9d84a9bdd">texDataWidth</a>) + (tempX &lt;&lt; 2) + 3] = ((tempData[(tempLine * tempHeader.bytesPerLine) + tempX] &amp; 0x02) &lt;&lt; 3) + (tempData[(tempLine * tempHeader.bytesPerLine) + tempX] &amp; 0x01);
<a name="l00192"></a>00192                     }
<a name="l00193"></a>00193                }
<a name="l00194"></a>00194           } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(tempHeader.bpp == 2) {
<a name="l00195"></a>00195                <span class="keywordflow">for</span>(tempLine = 0; tempLine &lt; tempHeight; tempLine++) {
<a name="l00196"></a>00196                     <span class="keywordflow">for</span>(tempX = 0; tempX &lt; ((tempWidth + 3) &gt;&gt; 2); tempX++) {
<a name="l00197"></a>00197                          tempOut-&gt;<a class="code" href="structTexture.html#4384d0e3734c3a45f6ebc36f6738962d">texData</a>[(tempLine * tempOut-&gt;<a class="code" href="structTexture.html#e23e28838c5e73a89d7216c9d84a9bdd">texDataWidth</a>) + (tempX &lt;&lt; 1)] = ((tempData[(tempLine * tempHeader.bytesPerLine) + tempX] &amp; 0xC0) &gt;&gt; 2) + ((tempData[(tempLine * tempHeader.bytesPerLine) + tempX] &amp; 0x30) &gt;&gt; 4);
<a name="l00198"></a>00198                          tempOut-&gt;<a class="code" href="structTexture.html#4384d0e3734c3a45f6ebc36f6738962d">texData</a>[(tempLine * tempOut-&gt;<a class="code" href="structTexture.html#e23e28838c5e73a89d7216c9d84a9bdd">texDataWidth</a>) + (tempX &lt;&lt; 1) + 1] = ((tempData[(tempLine * tempHeader.bytesPerLine) + tempX] &amp; 0x0C) &lt;&lt; 2) + (tempData[(tempLine * tempHeader.bytesPerLine) + tempX] &amp; 0x03);
<a name="l00199"></a>00199                     }
<a name="l00200"></a>00200                }
<a name="l00201"></a>00201           } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(tempHeader.bpp == 4) {
<a name="l00202"></a>00202                <span class="keywordflow">for</span>(tempLine = 0; tempLine &lt; tempHeight; tempLine++) {
<a name="l00203"></a>00203                     <span class="keywordflow">for</span>(tempX = 0; tempX &lt; ((tempWidth + 1) &gt;&gt; 1); tempX++) {
<a name="l00204"></a>00204                          tempOut-&gt;<a class="code" href="structTexture.html#4384d0e3734c3a45f6ebc36f6738962d">texData</a>[(tempLine * tempOut-&gt;<a class="code" href="structTexture.html#e23e28838c5e73a89d7216c9d84a9bdd">texDataWidth</a>) + tempX] = tempData[(tempLine * tempHeader.bytesPerLine) + tempX];
<a name="l00205"></a>00205                     }
<a name="l00206"></a>00206                }               
<a name="l00207"></a>00207           } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(tempHeader.bpp == 8) {
<a name="l00208"></a>00208                <span class="keywordflow">if</span>(tempPalette == tempHeader.palette) {
<a name="l00209"></a>00209                     #<span class="keywordflow">if</span> <a class="code" href="flConfig_8h.html#43900c4b670f70af67248dcbffbf45fd">FL_DEBUG_ERROR</a> != 0
<a name="l00210"></a>00210                     <a class="code" href="flDebug_8h.html#2cd68b8e989a5902ba62dabe20596f07">debugError</a>(<span class="stringliteral">"PCX load error (%s).\n256 color image doesn't contain a palette."</span>, inPath);
<a name="l00211"></a>00211 <span class="preprocessor">                    #endif</span>
<a name="l00212"></a>00212 <span class="preprocessor"></span>                    <a class="code" href="flMemory_8h.html#b5a200b09037e42c940e59383787470c">memFree</a>(tempData);
<a name="l00213"></a>00213                     <a class="code" href="flTexture_8c.html#8fb8e4b38a9296ed9af008419170efee">texFree</a>(tempOut);
<a name="l00214"></a>00214                     <span class="keywordflow">return</span> <a class="code" href="flTypes_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00215"></a>00215                }
<a name="l00216"></a>00216                <span class="keywordflow">for</span>(tempLine = 0; tempLine &lt; tempHeight; tempLine++) {
<a name="l00217"></a>00217                     <span class="keywordflow">for</span>(tempX = 0; tempX &lt; tempWidth; tempX++) {
<a name="l00218"></a>00218                          tempOut-&gt;texData[(tempLine * tempOut-&gt;texDataWidth) + tempX] =  tempData[(tempLine * tempHeader.bytesPerLine) + tempX];
<a name="l00219"></a>00219                     }
<a name="l00220"></a>00220                }
<a name="l00221"></a>00221           } <span class="keywordflow">else</span> {
<a name="l00222"></a>00222 <span class="preprocessor">               #if FL_DEBUG_ERROR != 0</span>
<a name="l00223"></a>00223 <span class="preprocessor"></span>               <a class="code" href="flDebug_8h.html#2cd68b8e989a5902ba62dabe20596f07">debugError</a>(<span class="stringliteral">"PCX load error (%s).\nUnsupported BPP(%i)/ColorPlane(%i) combo."</span>, inPath, tempHeader.bpp, tempHeader.colorPlanes);
<a name="l00224"></a>00224 <span class="preprocessor">               #endif</span>
<a name="l00225"></a>00225 <span class="preprocessor"></span>               <a class="code" href="flMemory_8h.html#b5a200b09037e42c940e59383787470c">memFree</a>(tempData);
<a name="l00226"></a>00226                <a class="code" href="flTexture_8c.html#8fb8e4b38a9296ed9af008419170efee">texFree</a>(tempOut);
<a name="l00227"></a>00227                <span class="keywordflow">return</span> <a class="code" href="flTypes_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00228"></a>00228           }
<a name="l00229"></a>00229      } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(tempHeader.colorPlanes == 3) {
<a name="l00230"></a>00230           <span class="keywordflow">if</span>(tempHeader.bpp == 8) {
<a name="l00231"></a>00231                <span class="keywordflow">for</span>(tempLine = 0; tempLine &lt; tempHeight; tempLine++) {
<a name="l00232"></a>00232                     <span class="keywordflow">for</span>(tempX = 0; tempX &lt; tempWidth; tempX++) {
<a name="l00233"></a>00233                          tempOut-&gt;texData[((tempLine * 3) * (tempOut-&gt;texDataWidth &lt;&lt; 2)) + (tempX &lt;&lt; 2)] = tempData[((tempLine * 3) * tempHeader.bytesPerLine) + tempX];
<a name="l00234"></a>00234                          tempOut-&gt;texData[((tempLine * 3) * (tempOut-&gt;texDataWidth &lt;&lt; 2)) + (tempX &lt;&lt; 2) + 1] = tempData[(((tempLine * 3) + 1) * tempHeader.bytesPerLine) + tempX];
<a name="l00235"></a>00235                          tempOut-&gt;texData[((tempLine * 3) * (tempOut-&gt;texDataWidth &lt;&lt; 2)) + (tempX &lt;&lt; 2) + 2] = tempData[(((tempLine * 3) + 2) * tempHeader.bytesPerLine) + tempX];
<a name="l00236"></a>00236                          tempOut-&gt;texData[((tempLine * 3) * (tempOut-&gt;texDataWidth &lt;&lt; 2)) + (tempX &lt;&lt; 2) + 3] = 0xFF;
<a name="l00237"></a>00237                     }
<a name="l00238"></a>00238                }
<a name="l00239"></a>00239           } <span class="keywordflow">else</span> {
<a name="l00240"></a>00240 <span class="preprocessor">               #if FL_DEBUG_ERROR != 0</span>
<a name="l00241"></a>00241 <span class="preprocessor"></span>               <a class="code" href="flDebug_8h.html#2cd68b8e989a5902ba62dabe20596f07">debugError</a>(<span class="stringliteral">"PCX load error (%s).\nUnsupported BPP(%i)/ColorPlane(%i) combo."</span>, inPath, tempHeader.bpp, tempHeader.colorPlanes);
<a name="l00242"></a>00242 <span class="preprocessor">               #endif</span>
<a name="l00243"></a>00243 <span class="preprocessor"></span>               <a class="code" href="flMemory_8h.html#b5a200b09037e42c940e59383787470c">memFree</a>(tempData);
<a name="l00244"></a>00244                <a class="code" href="flTexture_8c.html#8fb8e4b38a9296ed9af008419170efee">texFree</a>(tempOut);
<a name="l00245"></a>00245                <span class="keywordflow">return</span> <a class="code" href="flTypes_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00246"></a>00246           }
<a name="l00247"></a>00247      } <span class="keywordflow">else</span> {
<a name="l00248"></a>00248 <span class="preprocessor">          #if FL_DEBUG_ERROR != 0</span>
<a name="l00249"></a>00249 <span class="preprocessor"></span>          <a class="code" href="flDebug_8h.html#2cd68b8e989a5902ba62dabe20596f07">debugError</a>(<span class="stringliteral">"PCX load error (%s).\nUnsupported BPP(%i)/ColorPlane(%i) combo."</span>, inPath, tempHeader.bpp, tempHeader.colorPlanes);
<a name="l00250"></a>00250 <span class="preprocessor">          #endif</span>
<a name="l00251"></a>00251 <span class="preprocessor"></span>          <a class="code" href="flMemory_8h.html#b5a200b09037e42c940e59383787470c">memFree</a>(tempData);
<a name="l00252"></a>00252           <a class="code" href="flTexture_8c.html#8fb8e4b38a9296ed9af008419170efee">texFree</a>(tempOut);
<a name="l00253"></a>00253           <span class="keywordflow">return</span> <a class="code" href="flTypes_8h.html#070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00254"></a>00254      }
<a name="l00255"></a>00255      
<a name="l00256"></a>00256      <a class="code" href="flMemory_8h.html#b5a200b09037e42c940e59383787470c">memFree</a>(tempData);
<a name="l00257"></a>00257      <span class="keywordflow">return</span> tempOut;
<a name="l00258"></a>00258 }
<a name="l00259"></a>00259 
<a name="l00260"></a><a class="code" href="flTexturePCX_8h.html#3a47214f4f264bd2f85808dfb0aa9ea1">00260</a> <span class="keywordtype">bool</span> <a class="code" href="flTexturePCX_8c.html#3a47214f4f264bd2f85808dfb0aa9ea1">texSavePCX</a>(<a class="code" href="structTexture.html">Texture</a>* inTex, <span class="keywordtype">char</span>* inPath) {
<a name="l00261"></a>00261 <span class="preprocessor">     #if FL_DEBUG_WARNING != 0</span>
<a name="l00262"></a>00262 <span class="preprocessor"></span>     <a class="code" href="flDebug_8h.html#a122223db39f9f6ab0773adbf5de1a97">debugWarning</a>(<span class="stringliteral">"PCX saving not yet implemented."</span>);
<a name="l00263"></a>00263 <span class="preprocessor">     #endif</span>
<a name="l00264"></a>00264 <span class="preprocessor"></span>     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00265"></a>00265 }
<a name="l00266"></a>00266 
<a name="l00267"></a>00267 <span class="preprocessor">#endif</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Sep 5 19:04:01 2007 for funcLib by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.1 </small></address>
</body>
</html>
